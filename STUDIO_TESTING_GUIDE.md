# 🧪 Studio 保存功能测试指南

## 快速测试清单

### ✅ 测试 1：创建新提示词

**步骤：**
1. 启动前后端服务
2. 登录账号
3. 访问 `/studio`
4. 输入想法：`a beautiful sunset over the ocean`
5. 选择模型：`Sora`
6. 选择风格：`Cinematic`
7. 点击"Generate Prompt"
8. 等待生成完成
9. 点击"保存提示词"按钮（绿色大按钮）
10. 填写表单：
    - 标题：`Beautiful Ocean Sunset`
    - 描述：`A cinematic sunset scene over the ocean`
    - 分类：`视频生成`
    - 标签：`cinematic`, `sunset`, `ocean`
11. 点击"保存"
12. 验证：
    - ✅ 显示成功消息
    - ✅ 2秒后自动跳转到详情页
    - ✅ 详情页显示正确的内容

---

### ✅ 测试 2：编辑提示词

**步骤：**
1. 从"我的提示词"页面找到刚才创建的提示词
2. 点击"编辑"按钮
3. 验证：
    - ✅ URL 变为 `/studio?edit=xxx`
    - ✅ 页面标题变为 "Edit Prompt"
    - ✅ 提示词内容已加载
4. 修改提示词（在结构化编辑器中修改）
5. 点击"更新提示词"按钮
6. 验证表单已预填充
7. 修改标题为：`Beautiful Ocean Sunset - Updated`
8. 点击"更新"
9. 验证：
    - ✅ 显示"提示词更新成功！"
    - ✅ 跳转到详情页
    - ✅ 详情页显示更新后的内容

---

### ✅ 测试 3：草稿自动保存

**步骤：**
1. 访问 `/studio`（全新页面）
2. 输入想法：`a futuristic city`
3. 生成提示词
4. **不要保存！**
5. 关闭浏览器标签页或刷新页面
6. 重新打开 `/studio`
7. 验证：
    - ✅ 想法自动恢复
    - ✅ 生成的提示词自动恢复
    - ✅ 模型和风格选择恢复

**清除草稿测试：**
8. 保存这个提示词
9. 关闭标签页
10. 重新打开 `/studio`
11. 验证：
    - ✅ 页面是空白的（草稿已清除）

---

### ✅ 测试 4：权限验证

**步骤：**
1. 使用账号A登录并创建一个提示词
2. 记下提示词ID（从URL获取）
3. 退出登录
4. 使用账号B登录
5. 手动访问 `/studio?edit=<账号A的提示词ID>`
6. 验证：
    - ✅ 显示"您只能编辑自己创建的提示词"
    - ✅ 自动跳转到 `/studio`

---

### ✅ 测试 5：表单验证

**步骤：**
1. 生成一个提示词
2. 点击"保存提示词"
3. 不填任何内容，直接点击"保存"
4. 验证：
    - ✅ 显示错误："请输入标题"

**测试标题长度：**
5. 输入标题：`ab`（只有2个字符）
6. 点击"保存"
7. 验证：
    - ✅ 显示错误："标题至少需要3个字符"

**测试成功保存：**
8. 输入标题：`Test Prompt`（3个字符以上）
9. 点击"保存"
10. 验证：
    - ✅ 保存成功

---

### ✅ 测试 6：标签管理

**步骤：**
1. 打开保存对话框
2. 在标签输入框输入：`test-tag`
3. 按回车键
4. 验证：
    - ✅ 标签添加成功
    - ✅ 显示为圆角标签

**点击添加按钮：**
5. 输入：`another-tag`
6. 点击"添加"按钮
7. 验证：
    - ✅ 标签添加成功

**使用推荐标签：**
8. 点击推荐标签中的 `cinematic`
9. 验证：
    - ✅ 标签添加到列表
    - ✅ 该标签从推荐列表中消失

**删除标签：**
10. 点击任意标签的 ✕ 按钮
11. 验证：
    - ✅ 标签被删除

---

### ✅ 测试 7：草稿过期清理

**步骤：**
1. 打开浏览器开发者工具
2. 进入 Console
3. 执行：
```javascript
// 创建一个超过24小时的草稿
const oldDraft = {
  idea: 'old draft',
  timestamp: new Date(Date.now() - 25 * 60 * 60 * 1000).toISOString()
};
localStorage.setItem('promptvalar_draft', JSON.stringify(oldDraft));
```
4. 刷新 `/studio` 页面
5. 验证：
    - ✅ 页面是空白的（过期草稿已清除）
6. 检查 localStorage
7. 验证：
    - ✅ `promptvalar_draft` 已被删除

---

## 🔧 调试提示

### 查看草稿数据
```javascript
// 在浏览器 Console 中执行
const draft = localStorage.getItem('promptvalar_draft');
console.log(JSON.parse(draft));
```

### 清除草稿
```javascript
localStorage.removeItem('promptvalar_draft');
```

### 查看所有 localStorage
```javascript
console.log(localStorage);
```

---

## 🐛 常见问题排查

### 问题 1：保存按钮不显示
**原因：** 没有生成提示词
**解决：** 先生成提示词，保存按钮会出现在 Step 3

### 问题 2：保存失败 - 401 错误
**原因：** 未登录或 token 过期
**解决：** 重新登录

### 问题 3：保存失败 - 400 错误
**原因：** 数据验证失败
**解决：** 检查必填字段，确保标题至少3个字符

### 问题 4：编辑页面加载失败
**原因：** 
- 提示词不存在
- 不是作者本人
- 网络错误

**解决：** 
- 检查提示词ID是否正确
- 确认是使用作者账号登录
- 检查网络连接

### 问题 5：草稿没有恢复
**原因：** 
- 草稿已过期（>24小时）
- 正在编辑模式（有 ?edit 参数）
- 草稿数据损坏

**解决：** 
- 重新创建
- 检查 localStorage 中的数据

---

## 📊 测试结果记录

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 创建新提示词 | ⬜ 待测试 | |
| 编辑提示词 | ⬜ 待测试 | |
| 草稿自动保存 | ⬜ 待测试 | |
| 权限验证 | ⬜ 待测试 | |
| 表单验证 | ⬜ 待测试 | |
| 标签管理 | ⬜ 待测试 | |
| 草稿过期清理 | ⬜ 待测试 | |

测试完成后，将 ⬜ 改为 ✅（通过）或 ❌（失败）

---

## 🚀 快速启动命令

### 启动后端
```bash
cd backend
npm run dev
```

### 启动前端
```bash
cd frontend
npm run dev
```

### 访问地址
- 前端：http://localhost:3000
- 后端：http://localhost:5000
- Studio：http://localhost:3000/studio

---

## 📝 测试注意事项

1. **使用真实数据**：不要使用测试占位符，使用真实的提示词内容
2. **测试边界情况**：空字符串、超长字符串、特殊字符
3. **测试网络错误**：断开网络，测试错误处理
4. **测试性能**：大量标签、长描述
5. **测试兼容性**：不同浏览器、不同设备

---

## ✅ 预期结果总结

所有测试应该：
- ✅ 没有控制台错误
- ✅ 没有 404 或 500 错误
- ✅ UI 响应流畅
- ✅ 数据保存正确
- ✅ 权限控制有效
- ✅ 错误提示友好
- ✅ 自动跳转正常

---

**祝测试顺利！** 🎉

如果发现任何问题，请记录详细的错误信息和重现步骤。

