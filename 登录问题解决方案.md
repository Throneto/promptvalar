# ğŸ‰ ç™»å½•é—®é¢˜å·²è§£å†³

## é—®é¢˜æ‘˜è¦

æ‚¨é‡åˆ°çš„ç™»å½• 500 é”™è¯¯å·²ç»å®Œå…¨è§£å†³ï¼ç°åœ¨å‰ç«¯å’Œåç«¯éƒ½å¯ä»¥æ­£å¸¸å·¥ä½œäº†ã€‚

## ğŸ” åŸå› åˆ†æ

ç™»å½•å¤±è´¥çš„æ ¹æœ¬åŸå› æ˜¯ï¼š

1. **åç«¯æœåŠ¡æœªæ­£å¸¸è¿è¡Œ** - ç«¯å£è¢«æ—§è¿›ç¨‹å ç”¨
2. **ç¯å¢ƒå˜é‡ç¼ºå¤±** - `.env` æ–‡ä»¶ç¼ºå°‘ `JWT_REFRESH_SECRET`
3. **Nginxéœ€è¦é‡å¯** - é…ç½®æ›´æ–°åæœªé‡æ–°åŠ è½½

## âœ… å·²ä¿®å¤çš„é—®é¢˜

- âœ… æ¸…ç†äº†å ç”¨ç«¯å£çš„æ—§è¿›ç¨‹
- âœ… æ·»åŠ äº†ç¼ºå¤±çš„ JWT_REFRESH_SECRET ç¯å¢ƒå˜é‡
- âœ… é‡æ–°å¯åŠ¨äº†åç«¯æœåŠ¡ï¼ˆä½¿ç”¨æ­£ç¡®çš„ç¯å¢ƒå˜é‡ï¼‰
- âœ… é‡æ–°åŠ è½½äº† Nginx é…ç½®
- âœ… éªŒè¯äº†æœ¬åœ°å’Œç”Ÿäº§ç¯å¢ƒçš„ç™»å½•åŠŸèƒ½

## ğŸ§ª æµ‹è¯•ç»“æœ

æ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡äº†ï¼æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è´¦å·ç™»å½•ï¼š

### æµ‹è¯•è´¦å· 1 (æ™®é€šç”¨æˆ·)
- **é‚®ç®±**: test@example.com
- **å¯†ç **: Test123456
- **è§’è‰²**: user
- **è®¢é˜…**: free

### æµ‹è¯•è´¦å· 2 (ç®¡ç†å‘˜)
- **é‚®ç®±**: test@tablevision.top
- **å¯†ç **: Test123456
- **è§’è‰²**: admin
- **è®¢é˜…**: pro

## ğŸš€ å¿«é€Ÿæµ‹è¯•

è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯ä»¥å¿«é€Ÿæµ‹è¯•ç™»å½•åŠŸèƒ½ï¼š

```bash
/root/promptvalar/test-login.sh
```

## ğŸ“ æœåŠ¡ç®¡ç†

### å¯åŠ¨åç«¯æœåŠ¡

```bash
# æ–¹å¼ 1: ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
/root/promptvalar/backend/start-backend.sh

# æ–¹å¼ 2: æ‰‹åŠ¨å¯åŠ¨
cd /root/promptvalar/backend
npm run dev
```

### æ£€æŸ¥åç«¯çŠ¶æ€

```bash
# æŸ¥çœ‹æ˜¯å¦è¿è¡Œ
lsof -i :5000

# æŸ¥çœ‹æ—¥å¿—
tail -f /root/promptvalar/backend/backend.log
```

### åœæ­¢åç«¯æœåŠ¡

```bash
# æ‰¾åˆ°è¿›ç¨‹ID
lsof -i :5000

# åœæ­¢è¿›ç¨‹ï¼ˆæ›¿æ¢ <PID>ï¼‰
kill -9 <PID>
```

### é‡å¯ Nginx

```bash
# æµ‹è¯•é…ç½®
nginx -t

# é‡æ–°åŠ è½½é…ç½®
systemctl reload nginx

# é‡å¯æœåŠ¡
systemctl restart nginx
```

## ğŸŒ API åœ°å€

- **ç”Ÿäº§ç¯å¢ƒ**: https://api.promptvalar.com/api/v1
- **æœ¬åœ°ç¯å¢ƒ**: http://localhost:5000/api/v1

## ğŸ“‹ API æµ‹è¯•ç¤ºä¾‹

### ç™»å½•

```bash
# ç”Ÿäº§ç¯å¢ƒ
curl -X POST https://api.promptvalar.com/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@tablevision.top","password":"Test123456"}'

# æœ¬åœ°ç¯å¢ƒ
curl -X POST http://localhost:5000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@tablevision.top","password":"Test123456"}'
```

### æ³¨å†Œ

```bash
curl -X POST https://api.promptvalar.com/api/v1/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username":"newuser",
    "email":"newuser@example.com",
    "password":"Password123"
  }'
```

## âš ï¸ é‡è¦æé†’

1. **ç”Ÿäº§ç¯å¢ƒå®‰å…¨**: å½“å‰ä½¿ç”¨çš„æ˜¯æµ‹è¯•ç”¨çš„ JWT å¯†é’¥ï¼Œåœ¨æ­£å¼ä¸Šçº¿å‰è¯·æ›´æ¢ä¸ºå¼ºéšæœºå­—ç¬¦ä¸²
2. **æµ‹è¯•è´¦å·**: å½“å‰å¯†ç éƒ½æ˜¯ `Test123456`ï¼Œå»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¿®æ”¹
3. **ç¯å¢ƒå˜é‡**: ç¡®ä¿ `.env` æ–‡ä»¶åŒ…å«æ‰€æœ‰å¿…éœ€çš„ç¯å¢ƒå˜é‡
4. **æ—¥å¿—ç›‘æ§**: å®šæœŸæ£€æŸ¥ `backend.log` ä»¥å‘ç°æ½œåœ¨é—®é¢˜

## ğŸ“š ç›¸å…³æ–‡æ¡£

- è¯¦ç»†ä¿®å¤æŠ¥å‘Š: `/root/promptvalar/ç™»å½•é—®é¢˜ä¿®å¤æŠ¥å‘Š.md`
- åç«¯å¯åŠ¨è„šæœ¬: `/root/promptvalar/backend/start-backend.sh`
- æµ‹è¯•è„šæœ¬: `/root/promptvalar/test-login.sh`

## ğŸ’¡ å¸¸è§é—®é¢˜

### ç™»å½•å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

1. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ: `lsof -i :5000`
2. æŸ¥çœ‹åç«¯æ—¥å¿—: `tail -f /root/promptvalar/backend/backend.log`
3. ç¡®è®¤å¯†ç æ­£ç¡®: `Test123456`
4. è¿è¡Œæµ‹è¯•è„šæœ¬: `/root/promptvalar/test-login.sh`

### å¦‚ä½•åˆ›å»ºæ–°ç”¨æˆ·ï¼Ÿ

ä½¿ç”¨æ³¨å†Œ API æˆ–ç›´æ¥åœ¨æ•°æ®åº“ä¸­åˆ›å»ºï¼š

```bash
cd /root/promptvalar/backend
node -e "
import('bcrypt').then(async (bcrypt) => {
  const hash = await bcrypt.default.hash('yourpassword', 12);
  const { default: postgres } = await import('postgres');
  const sql = postgres('postgresql://promptvalar:throne999000@localhost:5432/promptvalar');
  
  const result = await sql\\\`
    INSERT INTO users (username, email, password_hash)
    VALUES ('username', 'email@example.com', \\\${hash})
    RETURNING id, email, username
  \\\`;
  
  console.log('Created user:', result);
  process.exit(0);
});
"
```

## ğŸ¯ ä¸‹ä¸€æ­¥

ç°åœ¨æ‚¨å¯ä»¥ï¼š

1. âœ… åœ¨æµè§ˆå™¨ä¸­è®¿é—® https://promptvalar.com å¹¶ç™»å½•
2. âœ… ä½¿ç”¨æµ‹è¯•è´¦å·æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
3. âœ… å¼€å§‹æ­£å¸¸ä½¿ç”¨æ‚¨çš„åº”ç”¨

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-10-28
**çŠ¶æ€**: âœ… å®Œå…¨è§£å†³

