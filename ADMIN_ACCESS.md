# ç®¡ç†å‘˜åå°è®¿é—®æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

PromptValar æä¾›äº†å®Œæ•´çš„ç®¡ç†å‘˜åå°ç³»ç»Ÿï¼Œç”¨äºç®¡ç†ç”¨æˆ·ã€æç¤ºè¯å’ŒæŸ¥çœ‹ç³»ç»Ÿç»Ÿè®¡æ•°æ®ã€‚

---

## ğŸŒ ç®¡ç†åå°åœ°å€

### å¼€å‘ç¯å¢ƒ
- **åœ°å€**: http://localhost:3000/admin
- **API**: http://localhost:5000/api/v1/admin/*

### ç”Ÿäº§ç¯å¢ƒ
- **åœ°å€**: https://promptvalar.com/admin
- **API**: https://api.promptvalar.com/api/v1/admin/*

---

## ğŸ” è®¿é—®æƒé™

### ç®¡ç†å‘˜æƒé™è¦æ±‚
ç®¡ç†å‘˜åå°ä½¿ç”¨ `AdminRoute` ç»„ä»¶ä¿æŠ¤ï¼Œåªæœ‰æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„ç”¨æˆ·æ‰èƒ½è®¿é—®ï¼š

1. âœ… å·²ç™»å½•ï¼ˆæœ‰æ•ˆçš„ JWT tokenï¼‰
2. âœ… ç”¨æˆ·è§’è‰²ä¸º `admin`ï¼ˆrole = 'admin'ï¼‰

å¦‚æœä¸æ»¡è¶³æ¡ä»¶ï¼Œå°†è¢«é‡å®šå‘ï¼š
- æœªç™»å½• â†’ `/login`
- å·²ç™»å½•ä½†éç®¡ç†å‘˜ â†’ `/` (é¦–é¡µ)

---

## ğŸ‘¤ åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

### æ–¹æ³• 1: ä½¿ç”¨è®¾ç½®è„šæœ¬ï¼ˆæ¨èï¼‰

1. **å…ˆæ³¨å†Œä¸€ä¸ªæ™®é€šè´¦æˆ·**
   - è®¿é—® https://promptvalar.com/register
   - æˆ– http://localhost:3000/register
   - å¡«å†™ç”¨æˆ·åã€é‚®ç®±å’Œå¯†ç å®Œæˆæ³¨å†Œ

2. **å°†è´¦æˆ·è®¾ç½®ä¸ºç®¡ç†å‘˜**
```bash
cd /root/promptvalar
./set-admin.sh your-email@example.com
```

ç¤ºä¾‹ï¼š
```bash
./set-admin.sh admin@promptvalar.com
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
- å°†ç”¨æˆ·è§’è‰²æ›´æ–°ä¸º admin
- æ˜¾ç¤ºæ›´æ–°åçš„ç”¨æˆ·ä¿¡æ¯

### æ–¹æ³• 2: ç›´æ¥ä¿®æ”¹æ•°æ®åº“

```bash
# ä½¿ç”¨ postgres ç”¨æˆ·è¿æ¥æ•°æ®åº“
sudo -u postgres psql -d promptvalar

# å°†ç”¨æˆ·è®¾ç½®ä¸ºç®¡ç†å‘˜
UPDATE users SET role = 'admin' WHERE email = 'your-email@example.com';

# éªŒè¯æ›´æ–°
SELECT id, username, email, role FROM users WHERE email = 'your-email@example.com';

# é€€å‡º
\q
```

### æ–¹æ³• 3: ä½¿ç”¨ PGPASSWORD ç¯å¢ƒå˜é‡

```bash
PGPASSWORD=throne999000 psql -U promptvalar -h localhost -d promptvalar -c "UPDATE users SET role = 'admin' WHERE email = 'your-email@example.com';"
```

---

## ğŸ¯ ç®¡ç†åå°åŠŸèƒ½

### 1. ä»ªè¡¨æ¿ (`/admin`)
**è·¯å¾„**: `/admin`

åŠŸèƒ½ï¼š
- ğŸ“Š ç³»ç»Ÿç»Ÿè®¡æ•°æ®ï¼ˆæ€»ç”¨æˆ·æ•°ã€æç¤ºè¯æ•°ã€æ”¶è—æ•°ç­‰ï¼‰
- ğŸ“ˆ ç”¨æˆ·å¢é•¿è¶‹åŠ¿å›¾è¡¨
- ğŸ† çƒ­é—¨æç¤ºè¯æ’è¡Œæ¦œ
- âš¡ å®æ—¶ç³»ç»ŸçŠ¶æ€

### 2. ç”¨æˆ·ç®¡ç† (`/admin/users`)
**è·¯å¾„**: `/admin/users`

åŠŸèƒ½ï¼š
- ğŸ‘¥ æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·åˆ—è¡¨
- ğŸ” æœç´¢ç”¨æˆ·ï¼ˆç”¨æˆ·åã€é‚®ç®±ï¼‰
- âœï¸ ç¼–è¾‘ç”¨æˆ·ä¿¡æ¯
- ğŸ”‘ é‡ç½®ç”¨æˆ·å¯†ç 
- ğŸš« ç¦ç”¨/å¯ç”¨ç”¨æˆ·è´¦æˆ·
- ğŸ—‘ï¸ åˆ é™¤ç”¨æˆ·
- ğŸ“„ åˆ†é¡µæµè§ˆ

### 3. æç¤ºè¯ç®¡ç† (`/admin/prompts`)
**è·¯å¾„**: `/admin/admin/prompts`

åŠŸèƒ½ï¼š
- ğŸ“ æŸ¥çœ‹æ‰€æœ‰æç¤ºè¯
- ğŸ” æœç´¢å’Œç­›é€‰æç¤ºè¯
- âœï¸ ç¼–è¾‘æç¤ºè¯å†…å®¹
- ğŸ‘ï¸ è®¾ç½®æç¤ºè¯å¯è§æ€§ï¼ˆå‘å¸ƒ/å–æ¶ˆå‘å¸ƒï¼‰
- â­ è®¾ç½®é«˜çº§æç¤ºè¯æ ‡è®°
- ğŸ—‘ï¸ åˆ é™¤æç¤ºè¯
- ğŸ“„ åˆ†é¡µæµè§ˆ

---

## ğŸ” API ç«¯ç‚¹

ç®¡ç†å‘˜ API éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­åŒ…å«æœ‰æ•ˆçš„ JWT tokenï¼Œä¸”ç”¨æˆ·è§’è‰²å¿…é¡»ä¸º adminã€‚

### ä»ªè¡¨æ¿ç»Ÿè®¡
```http
GET /api/v1/admin/dashboard/stats
Authorization: Bearer <token>
```

è¿”å›ï¼šæ€»ç”¨æˆ·æ•°ã€æç¤ºè¯æ•°ã€æ”¶è—æ•°ç­‰ç»Ÿè®¡æ•°æ®

### ç”¨æˆ·å¢é•¿æ•°æ®
```http
GET /api/v1/admin/dashboard/user-growth?days=30
Authorization: Bearer <token>
```

### çƒ­é—¨æç¤ºè¯
```http
GET /api/v1/admin/dashboard/top-prompts?limit=10
Authorization: Bearer <token>
```

### ç”¨æˆ·åˆ—è¡¨
```http
GET /api/v1/admin/users?page=1&limit=20&search=keyword
Authorization: Bearer <token>
```

### æ›´æ–°ç”¨æˆ·
```http
PUT /api/v1/admin/users/:userId
Authorization: Bearer <token>
Content-Type: application/json

{
  "role": "admin",
  "isActive": true,
  "subscriptionTier": "premium"
}
```

### é‡ç½®ç”¨æˆ·å¯†ç 
```http
POST /api/v1/admin/users/:userId/reset-password
Authorization: Bearer <token>
Content-Type: application/json

{
  "newPassword": "new-secure-password"
}
```

### åˆ é™¤ç”¨æˆ·
```http
DELETE /api/v1/admin/users/:userId
Authorization: Bearer <token>
```

### æç¤ºè¯åˆ—è¡¨
```http
GET /api/v1/admin/prompts?page=1&limit=20&search=keyword
Authorization: Bearer <token>
```

### æ›´æ–°æç¤ºè¯
```http
PUT /api/v1/admin/prompts/:promptId
Authorization: Bearer <token>
Content-Type: application/json

{
  "isPublished": true,
  "isPremium": false
}
```

### åˆ é™¤æç¤ºè¯
```http
DELETE /api/v1/admin/prompts/:promptId
Authorization: Bearer <token>
```

---

## ğŸ›¡ï¸ æƒé™æ§åˆ¶

### å‰ç«¯è·¯ç”±ä¿æŠ¤
æ–‡ä»¶ï¼š`frontend/src/components/auth/AdminRoute.tsx`

```typescript
export default function AdminRoute({ children }: AdminRouteProps) {
  const isAuth = isAuthenticated();
  const isAdminUser = isAdmin();

  // æœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ
  if (!isAuth) {
    return <Navigate to="/login" replace />;
  }

  // å·²ç™»å½•ä½†ä¸æ˜¯ç®¡ç†å‘˜ï¼Œé‡å®šå‘åˆ°é¦–é¡µ
  if (!isAdminUser) {
    return <Navigate to="/" replace />;
  }

  // æ˜¯ç®¡ç†å‘˜ï¼Œå…è®¸è®¿é—®
  return <>{children}</>;
}
```

### åç«¯ä¸­é—´ä»¶ä¿æŠ¤
æ–‡ä»¶ï¼š`backend/src/middleware/auth.middleware.ts`

æ‰€æœ‰ç®¡ç†å‘˜ API ç«¯ç‚¹éƒ½å—åˆ°ä¸­é—´ä»¶ä¿æŠ¤ï¼Œä¼šéªŒè¯ï¼š
1. JWT token æœ‰æ•ˆæ€§
2. ç”¨æˆ·è§’è‰²æ˜¯å¦ä¸º admin

---

## ğŸ“ ä½¿ç”¨æµç¨‹

### å®Œæ•´è®¿é—®æµç¨‹

1. **æ³¨å†Œè´¦æˆ·**
   ```
   è®¿é—® /register â†’ å¡«å†™ä¿¡æ¯ â†’ æäº¤æ³¨å†Œ
   ```

2. **è®¾ç½®ç®¡ç†å‘˜æƒé™**
   ```bash
   cd /root/promptvalar
   ./set-admin.sh your-email@example.com
   ```

3. **ç™»å½•ç³»ç»Ÿ**
   ```
   è®¿é—® /login â†’ è¾“å…¥é‚®ç®±å’Œå¯†ç  â†’ ç™»å½•
   ```

4. **è®¿é—®ç®¡ç†åå°**
   ```
   è®¿é—® /admin â†’ æŸ¥çœ‹ä»ªè¡¨æ¿
   è®¿é—® /admin/users â†’ ç®¡ç†ç”¨æˆ·
   è®¿é—® /admin/prompts â†’ ç®¡ç†æç¤ºè¯
   ```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### 1. æ— æ³•è®¿é—®ç®¡ç†åå°ï¼ˆè¢«é‡å®šå‘åˆ°é¦–é¡µï¼‰

**åŸå› **: è´¦æˆ·æ²¡æœ‰ç®¡ç†å‘˜æƒé™

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥ç”¨æˆ·è§’è‰²
sudo -u postgres psql -d promptvalar -c "SELECT email, role FROM users WHERE email = 'your-email@example.com';"

# å¦‚æœ role ä¸æ˜¯ 'admin'ï¼Œæ‰§è¡Œè®¾ç½®è„šæœ¬
./set-admin.sh your-email@example.com
```

### 2. ç™»å½•åä»ç„¶æ— æ³•è®¿é—®

**åŸå› **: localStorage ä¸­çš„ç”¨æˆ·ä¿¡æ¯æœªæ›´æ–°

**è§£å†³æ–¹æ¡ˆ**:
1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’Œ localStorage
2. é€€å‡ºç™»å½•
3. é‡æ–°ç™»å½•

æˆ–åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œï¼š
```javascript
localStorage.clear();
window.location.reload();
```

### 3. API è¿”å› 403 Forbidden

**åŸå› **: JWT token ä¸­çš„ç”¨æˆ·è§’è‰²ä¸æ˜¯ admin

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤æ•°æ®åº“ä¸­ç”¨æˆ·è§’è‰²å·²æ›´æ–°ä¸º admin
2. é€€å‡ºç™»å½•å¹¶é‡æ–°ç™»å½•ä»¥è·å–æ–°çš„ token
3. æ–°çš„ token ä¼šåŒ…å«æ›´æ–°åçš„ç”¨æˆ·è§’è‰²ä¿¡æ¯

### 4. æ•°æ®åº“è¿æ¥å¤±è´¥

å¦‚æœä½¿ç”¨è„šæœ¬æ—¶å‡ºç°è¿æ¥é”™è¯¯ï¼š

```bash
# æ–¹æ³• 1: ä½¿ç”¨ postgres ç”¨æˆ·
sudo -u postgres psql -d promptvalar

# æ–¹æ³• 2: æŒ‡å®šä¸»æœºï¼ˆä½¿ç”¨ TCP è¿æ¥ï¼‰
PGPASSWORD=throne999000 psql -U promptvalar -h localhost -d promptvalar
```

---

## ğŸ“Š ç®¡ç†å‘˜é¡µé¢ç¤ºä¾‹

### ä»ªè¡¨æ¿
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š ç³»ç»Ÿç»Ÿè®¡                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‘¥ æ€»ç”¨æˆ·æ•°: 1,234                      â”‚
â”‚  ğŸ“ æ€»æç¤ºè¯æ•°: 5,678                    â”‚
â”‚  â­ æ€»æ”¶è—æ•°: 12,345                     â”‚
â”‚  ğŸ’ é«˜çº§ç”¨æˆ·: 123                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ˆ ç”¨æˆ·å¢é•¿è¶‹åŠ¿ (æœ€è¿‘30å¤©)              â”‚
â”‚  [æŠ˜çº¿å›¾]                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ† çƒ­é—¨æç¤ºè¯ TOP 10                    â”‚
â”‚  1. Prompt Title 1 - 1,234 views        â”‚
â”‚  2. Prompt Title 2 - 987 views          â”‚
â”‚  ...                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

1. **å¯†ç å®‰å…¨**
   - ä½¿ç”¨å¼ºå¯†ç 
   - å®šæœŸæ›´æ¢å¯†ç 
   - ä¸è¦åœ¨å…¬å…±åœºæ‰€ç™»å½•ç®¡ç†åå°

2. **æƒé™ç®¡ç†**
   - ä»…ç»™äºˆå¿…è¦äººå‘˜ç®¡ç†å‘˜æƒé™
   - å®šæœŸå®¡æŸ¥ç®¡ç†å‘˜è´¦æˆ·åˆ—è¡¨
   - åŠæ—¶æ’¤é”€ç¦»èŒäººå‘˜çš„ç®¡ç†å‘˜æƒé™

3. **æ“ä½œæ—¥å¿—**
   - æ‰€æœ‰ç®¡ç†å‘˜æ“ä½œéƒ½åº”è¯¥è¢«è®°å½•
   - å®šæœŸæ£€æŸ¥æ“ä½œæ—¥å¿—

4. **æ•°æ®åº“è®¿é—®**
   - é™åˆ¶æ•°æ®åº“è®¿é—®æƒé™
   - ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç›´æ¥ä¿®æ”¹æ•°æ®åº“

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚éœ€å¸®åŠ©ï¼Œè¯·ï¼š
1. æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£
2. è”ç³»å¼€å‘å›¢é˜Ÿ
3. æäº¤ Issue

---

**æœ€åæ›´æ–°**: 2025-10-26  
**ç»´æŠ¤è€…**: PromptValar å¼€å‘å›¢é˜Ÿ

