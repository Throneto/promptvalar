# PromptValar å®Œæ•´ä¿®å¤æ€»ç»“ - 2025-10-29

## ğŸ“‹ ä¿®å¤çš„é—®é¢˜æ¸…å•

### âœ… é—®é¢˜ 1: Meta æ ‡ç­¾å¼ƒç”¨è­¦å‘Š
**æŠ¥é”™ä¿¡æ¯**ï¼š
```
meta name="apple-mobile-web-app-capable" content="yes"> is deprecated. 
Please include <meta name="mobile-web-app-capable" content="yes">
```

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
- åœ¨ `frontend/index.html` æ·»åŠ æ ‡å‡†çš„ `mobile-web-app-capable` meta æ ‡ç­¾
- ä¿ç•™åŸæœ‰ iOS ä¸“ç”¨æ ‡ç­¾ä»¥ä¿æŒå‘åå…¼å®¹

**éªŒè¯ç»“æœ**ï¼šâœ… æ–°æ ‡ç­¾å·²éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

---

### âœ… é—®é¢˜ 2: API 500 é”™è¯¯
**æŠ¥é”™ä¿¡æ¯**ï¼š
```
Failed to load resource: the server responded with a status of 500
api.promptvalar.com/api/v1/ai/generate-prompt:1
```

**æ ¹æœ¬åŸå› **ï¼š
- OpenRouter API Key å¤±æ•ˆï¼ˆ401 User not foundï¼‰
- æ—§ Key: `sk-or-v1-5675...` (å·²å¤±æ•ˆ)

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
1. æ›´æ–° `/root/promptvalar/backend/.env` ä¸­çš„ API Key
2. æ›´æ–° PM2 é…ç½®æ–‡ä»¶ `/var/www/promptvalar/deployment/ecosystem.config.js`
3. é‡æ–°å¯åŠ¨åç«¯æœåŠ¡

**æ–° API Key**ï¼š`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`

**éªŒè¯ç»“æœ**ï¼šâœ… API æˆåŠŸç”Ÿæˆæç¤ºè¯
```json
{
  "success": true,
  "data": {
    "prompt": "A sleek humanoid robot...",
    "logId": "f8b59141-3356-4cbd-95c7-4e76fb0aa483"
  }
}
```

---

### âœ… é—®é¢˜ 3: Nginx 404 é”™è¯¯
**æŠ¥é”™ä¿¡æ¯**ï¼š
```
https://promptvalar.com/ 404 Not Found
nginx
```

**æ ¹æœ¬åŸå› **ï¼š
- Nginx é…ç½®è·¯å¾„é”™è¯¯ï¼š`root /var/www/promptvalar/frontend/dist;`
- å®é™…æ–‡ä»¶è·¯å¾„ï¼š`/var/www/promptvalar/frontend/`
- dist ç›®å½•ä¸å­˜åœ¨

**ä¿®å¤æ–¹æ¡ˆ**ï¼š
```bash
# ä¿®æ”¹ Nginx é…ç½®
sudo sed -i 's|root /var/www/promptvalar/frontend/dist;|root /var/www/promptvalar/frontend;|g' /etc/nginx/sites-available/promptvalar

# æµ‹è¯•é…ç½®
nginx -t

# é‡æ–°åŠ è½½
systemctl reload nginx
```

**éªŒè¯ç»“æœ**ï¼šâœ… ç½‘ç«™æ­£å¸¸è®¿é—®
```
HTTP/2 200 OK
Content-Type: text/html
```

---

## ğŸ” å®Œæ•´éªŒè¯æŠ¥å‘Š

### 1. å‰ç«¯ä¸»ç«™
```bash
curl -I https://promptvalar.com
```
**ç»“æœ**ï¼šâœ… HTTP/2 200 OK

### 2. Meta æ ‡ç­¾
```bash
curl -s https://promptvalar.com | grep mobile-web-app-capable
```
**ç»“æœ**ï¼šâœ… æ‰¾åˆ°æ–°æ ‡ç­¾
```html
<meta name="mobile-web-app-capable" content="yes" />
```

### 3. é™æ€èµ„æº
```bash
curl -I https://promptvalar.com/assets/index-DD6Ho667.js
```
**ç»“æœ**ï¼šâœ… HTTP/2 200 OK

### 4. API åç«¯å¥åº·æ£€æŸ¥
```bash
curl -I https://api.promptvalar.com/health
```
**ç»“æœ**ï¼šâœ… HTTP/2 200 OK

### 5. API æç¤ºè¯ç”Ÿæˆ
```bash
curl -X POST https://api.promptvalar.com/api/v1/ai/generate-prompt \
  -H "Content-Type: application/json" \
  -d '{"idea": "æœºå™¨äººåœ¨æœªæ¥åŸå¸‚ä¸­å¥”è·‘", "model": "sora", "style": "cinematic"}'
```
**ç»“æœ**ï¼šâœ… æˆåŠŸç”Ÿæˆç»“æ„åŒ–æç¤ºè¯

---

## ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”

| æ£€æŸ¥é¡¹ | ä¿®å¤å‰ | ä¿®å¤å |
|--------|--------|--------|
| **å‰ç«¯è®¿é—®** | âŒ 404 Not Found | âœ… 200 OK |
| **Meta æ ‡ç­¾** | âš ï¸ å¼ƒç”¨è­¦å‘Š | âœ… å·²æ›´æ–° |
| **API è°ƒç”¨** | âŒ 500 Error | âœ… æ­£å¸¸å“åº” |
| **PM2 çŠ¶æ€** | âš ï¸ ä½¿ç”¨æ—§ Key | âœ… ä½¿ç”¨æ–° Key |
| **Nginx é…ç½®** | âŒ è·¯å¾„é”™è¯¯ | âœ… è·¯å¾„æ­£ç¡® |
| **é™æ€èµ„æº** | âŒ æ— æ³•åŠ è½½ | âœ… æ­£å¸¸åŠ è½½ |

---

## ğŸ—‚ï¸ ä¿®æ”¹çš„æ–‡ä»¶åˆ—è¡¨

### å‰ç«¯æ–‡ä»¶
- âœ… `/root/promptvalar/frontend/index.html`
  - æ·»åŠ  `<meta name="mobile-web-app-capable" content="yes">`

### åç«¯é…ç½®
- âœ… `/root/promptvalar/backend/.env`
  - æ›´æ–° `OPENROUTER_API_KEY`
  
- âœ… `/var/www/promptvalar/deployment/ecosystem.config.js`
  - æ›´æ–° PM2 ç¯å¢ƒå˜é‡ä¸­çš„ `OPENROUTER_API_KEY`

### Nginx é…ç½®
- âœ… `/etc/nginx/sites-available/promptvalar`
  - ä¿®æ”¹ `root /var/www/promptvalar/frontend/dist;` â†’ `root /var/www/promptvalar/frontend;`

### éƒ¨ç½²
- âœ… å‰ç«¯é‡æ–°æ„å»ºå¹¶éƒ¨ç½²åˆ° `/var/www/promptvalar/frontend/`
- âœ… åç«¯ PM2 è¿›ç¨‹å·²é‡å¯
- âœ… Nginx é…ç½®å·²é‡æ–°åŠ è½½

---

## ğŸš€ æœåŠ¡çŠ¶æ€

### PM2 åç«¯è¿›ç¨‹
```
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ name                â”‚ mode    â”‚ uptime â”‚ â†º    â”‚ status    â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0  â”‚ promptvalar-backend â”‚ fork    â”‚ 25m    â”‚ 0    â”‚ online    â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
**çŠ¶æ€**ï¼šâœ… åœ¨çº¿è¿è¡Œ

### Nginx æœåŠ¡
```
â— nginx.service - A high performance web server
   Active: active (running) since Tue 2025-10-28 16:27:53 CST
```
**çŠ¶æ€**ï¼šâœ… è¿è¡Œä¸­

---

## ğŸ“ ç»´æŠ¤å»ºè®®

### 1. ç›‘æ§ OpenRouter API
- å®šæœŸæ£€æŸ¥è´¦æˆ·ä½™é¢
- è®¾ç½®ä½ä½™é¢å‘Šè­¦
- å¤‡ä»½ API Key åˆ°å®‰å…¨ä½ç½®

### 2. éƒ¨ç½²æµç¨‹ä¼˜åŒ–
åˆ›å»ºæ ‡å‡†åŒ–éƒ¨ç½²è„šæœ¬ `/root/promptvalar/scripts/deploy-frontend.sh`ï¼š

```bash
#!/bin/bash
set -e

echo "ğŸš€ å¼€å§‹éƒ¨ç½²å‰ç«¯..."

# æ„å»º
cd /root/promptvalar/frontend
npm run build

# å¤‡ä»½æ—§ç‰ˆæœ¬ï¼ˆå¯é€‰ï¼‰
if [ -d /var/www/promptvalar/frontend.backup ]; then
    rm -rf /var/www/promptvalar/frontend.backup
fi
cp -r /var/www/promptvalar/frontend /var/www/promptvalar/frontend.backup

# éƒ¨ç½²æ–°ç‰ˆæœ¬
rsync -av --delete dist/ /var/www/promptvalar/frontend/

# éªŒè¯ Nginx
nginx -t || exit 1

# é‡æ–°åŠ è½½ Nginx
systemctl reload nginx

# å¥åº·æ£€æŸ¥
sleep 2
STATUS=$(curl -s -o /dev/null -w "%{http_code}" https://promptvalar.com)
if [ "$STATUS" = "200" ]; then
    echo "âœ… éƒ¨ç½²æˆåŠŸï¼"
else
    echo "âŒ å¥åº·æ£€æŸ¥å¤±è´¥ï¼ŒçŠ¶æ€ç : $STATUS"
    echo "å›æ»šåˆ°å¤‡ä»½ç‰ˆæœ¬..."
    rsync -av --delete /var/www/promptvalar/frontend.backup/ /var/www/promptvalar/frontend/
    systemctl reload nginx
    exit 1
fi
```

### 3. é…ç½®ç›‘æ§
ä½¿ç”¨ Uptime Robot æˆ–ç±»ä¼¼æœåŠ¡ç›‘æ§ï¼š
- https://promptvalar.com (æ¯ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡)
- https://api.promptvalar.com/health (æ¯ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡)

### 4. æ—¥å¿—ç®¡ç†
å®šæœŸæ£€æŸ¥æ—¥å¿—ï¼š
```bash
# åç«¯æ—¥å¿—
pm2 logs promptvalar-backend --lines 100

# Nginx é”™è¯¯æ—¥å¿—
tail -100 /var/log/nginx/error.log

# Nginx è®¿é—®æ—¥å¿—
tail -100 /var/log/nginx/access.log
```

---

## ğŸ¯ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
# PM2 åç«¯
pm2 status

# Nginx
systemctl status nginx

# æ£€æŸ¥ç¯å¢ƒå˜é‡
pm2 env 0 | grep OPENROUTER
```

### é‡å¯æœåŠ¡
```bash
# é‡å¯åç«¯
pm2 restart promptvalar-backend

# é‡æ–°åŠ è½½ Nginx
systemctl reload nginx

# é‡å¯ Nginx
systemctl restart nginx
```

### æµ‹è¯• API
```bash
# å¥åº·æ£€æŸ¥
curl https://api.promptvalar.com/health

# æµ‹è¯•æç¤ºè¯ç”Ÿæˆ
curl -X POST https://api.promptvalar.com/api/v1/ai/generate-prompt \
  -H "Content-Type: application/json" \
  -d '{"idea":"æµ‹è¯•","model":"sora","style":"cinematic"}'
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# åç«¯å®æ—¶æ—¥å¿—
pm2 logs promptvalar-backend

# åç«¯æœ€è¿‘ 50 è¡Œ
pm2 logs promptvalar-backend --lines 50 --nostream

# Nginx é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/error.log
```

---

## âœ… ä¿®å¤å®Œæˆç¡®è®¤

- [x] Meta æ ‡ç­¾å¼ƒç”¨è­¦å‘Šå·²è§£å†³
- [x] API 500 é”™è¯¯å·²è§£å†³
- [x] Nginx 404 é”™è¯¯å·²è§£å†³
- [x] å‰ç«¯å·²é‡æ–°éƒ¨ç½²
- [x] åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ
- [x] æ‰€æœ‰åŠŸèƒ½éªŒè¯é€šè¿‡
- [x] åˆ›å»ºè¯¦ç»†æ–‡æ¡£

**æ€»ä¿®å¤æ—¶é—´**ï¼šçº¦ 30 åˆ†é’Ÿ  
**æœ€åéªŒè¯æ—¶é—´**ï¼š2025-10-29 21:47  
**ç³»ç»ŸçŠ¶æ€**ï¼šâœ… å®Œå…¨æ­£å¸¸

---

## ğŸ“ åç»­æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. **æœåŠ¡çŠ¶æ€**ï¼š`pm2 status` å’Œ `systemctl status nginx`
2. **æ—¥å¿—æ–‡ä»¶**ï¼š`pm2 logs` å’Œ `/var/log/nginx/error.log`
3. **é…ç½®æ–‡ä»¶**ï¼šç¡®ä¿æœªè¢«æ„å¤–ä¿®æ”¹
4. **API Key**ï¼šç¡®è®¤ä»ç„¶æœ‰æ•ˆä¸”æœ‰ä½™é¢

**æ‰€æœ‰ç³»ç»Ÿç°å·²å®Œå…¨æ¢å¤æ­£å¸¸è¿è¡Œï¼** ğŸ‰

