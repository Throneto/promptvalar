# ğŸ‰ PromptValar è®¢é˜…ç³»ç»Ÿæµ‹è¯•å®ŒæˆæŠ¥å‘Š

**æµ‹è¯•æ—¶é—´**: 2025-10-26  
**çŠ¶æ€**: âœ… å…¨éƒ¨é€šè¿‡  
**æµ‹è¯•æ¨¡å¼**: å·²å¯ç”¨ï¼ˆæ— éœ€ Stripe è´¦å·ï¼‰

---

## âœ… æµ‹è¯•ç»“æœæ±‡æ€»

### æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| è·å–è®¢é˜…è®¡åˆ’ | âœ… | æˆåŠŸè¿”å› Free å’Œ Pro è®¡åˆ’è¯¦æƒ… |
| ç”¨æˆ·æ³¨å†Œ | âœ… | æ³¨å†ŒæˆåŠŸå¹¶è·å– JWT Token |
| è·å–å½“å‰è®¢é˜… | âœ… | æ­£ç¡®æ˜¾ç¤ºè®¢é˜…çŠ¶æ€ |
| æµ‹è¯•æ¨¡å¼æ¿€æ´» Pro | âœ… | ä¸€é”®æ¿€æ´» Pro è®¢é˜… |
| åŠŸèƒ½è®¿é—®æ£€æŸ¥ | âœ… | æ­£ç¡®éªŒè¯é«˜çº§åŠŸèƒ½æƒé™ |
| å–æ¶ˆè®¢é˜… | âœ… | æˆåŠŸå–æ¶ˆå¹¶æ ‡è®°åœ¨å‘¨æœŸç»“æŸ |
| æ¢å¤è®¢é˜… | âœ… | æˆåŠŸæ¢å¤è®¢é˜… |

---

## ğŸ“Š è®¢é˜…è®¡åˆ’é…ç½®

### Free è®¡åˆ’
- **ä»·æ ¼**: Â¥0/æœˆ
- **åŠŸèƒ½**:
  - æ¯æœˆ 20 æ¬¡ AI ç”Ÿæˆ
  - è®¿é—®åŸºç¡€æç¤ºè¯åº“
  - åŸºç¡€æ¨¡å‹æ”¯æŒ
  - ç¤¾åŒºæ”¯æŒ

### Pro è®¡åˆ’
- **ä»·æ ¼**: Â¥19.99/æœˆ
- **åŠŸèƒ½**:
  - æ— é™æ¬¡ AI ç”Ÿæˆ
  - è®¿é—®æ‰€æœ‰é«˜çº§æç¤ºè¯
  - æ‰€æœ‰ AI æ¨¡å‹æ”¯æŒ
  - ä¼˜å…ˆå®¢æˆ·æ”¯æŒ
  - é«˜çº§ç¼–è¾‘å™¨åŠŸèƒ½
  - æç¤ºè¯å†å²è®°å½•
  - API è®¿é—®æƒé™

---

## ğŸš€ å¦‚ä½•ä½¿ç”¨

### å¯åŠ¨åç«¯æœåŠ¡ï¼ˆç«¯å£ 5001ï¼‰

```bash
# æ–¹å¼ 1: ä½¿ç”¨å¯åŠ¨è„šæœ¬
/root/promptvalar/start-subscription-backend.sh

# æ–¹å¼ 2: æ‰‹åŠ¨å¯åŠ¨
cd /root/promptvalar/backend
DATABASE_URL="postgresql://promptvalar:throne999000@localhost:5432/promptvalar" \
STRIPE_TEST_MODE=true \
STRIPE_SECRET_KEY=sk_test \
PORT=5001 \
OPENAI_API_KEY=sk-test \
OPENROUTER_API_KEY=sk-test \
CORS_ORIGIN=http://localhost:5173 \
JWT_SECRET=test \
JWT_REFRESH_SECRET=test \
npx tsx src/index.ts
```

### è¿è¡Œå®Œæ•´æµ‹è¯•

```bash
/root/promptvalar/test-subscription-complete.sh
```

---

## ğŸ§ª æµ‹è¯•æ¨¡å¼ç‰¹ç‚¹

### âœ… ä¼˜åŠ¿
1. **æ— éœ€ Stripe è´¦å·** - å¯ä»¥ç«‹å³æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
2. **ä¸€é”®æ¿€æ´»** - `POST /api/v1/subscriptions/test/activate`
3. **å®Œæ•´åŠŸèƒ½** - æ‰€æœ‰è®¢é˜…åŠŸèƒ½éƒ½å¯ä»¥æµ‹è¯•
4. **å¿«é€Ÿå¼€å‘** - é€‚åˆå¼€å‘å’Œæ¼”ç¤º

### ğŸ”„ æµ‹è¯•æµç¨‹
1. æ³¨å†Œç”¨æˆ· â†’ Free è´¦æˆ·
2. è°ƒç”¨æµ‹è¯•ç«¯ç‚¹ â†’ æ¿€æ´» Pro
3. éªŒè¯åŠŸèƒ½ â†’ è®¿é—®æƒé™æ­£ç¡®
4. å–æ¶ˆ/æ¢å¤ â†’ çŠ¶æ€æ›´æ–°æ­£å¸¸

---

## ğŸ“ API ç«¯ç‚¹æ¸…å•

### å…¬å¼€ç«¯ç‚¹
- `GET /api/v1/subscriptions/plans` - è·å–è®¢é˜…è®¡åˆ’

### è®¤è¯ç«¯ç‚¹
- `GET /api/v1/subscriptions/current` - è·å–å½“å‰è®¢é˜…
- `POST /api/v1/subscriptions/checkout` - åˆ›å»º Checkout
- `POST /api/v1/subscriptions/portal` - åˆ›å»º Portal
- `POST /api/v1/subscriptions/cancel` - å–æ¶ˆè®¢é˜…
- `POST /api/v1/subscriptions/resume` - æ¢å¤è®¢é˜…
- `GET /api/v1/subscriptions/check-access` - æ£€æŸ¥è®¿é—®æƒé™

### æµ‹è¯•æ¨¡å¼ç«¯ç‚¹
- `POST /api/v1/subscriptions/test/activate` - ä¸€é”®æ¿€æ´» Pro

---

## ğŸ’¡ å‰ç«¯é›†æˆç¤ºä¾‹

### è·å–è®¢é˜…è®¡åˆ’

```typescript
import axios from 'axios';

const API_BASE = 'http://localhost:5001/api/v1';

// è·å–è®¢é˜…è®¡åˆ’
const plans = await axios.get(`${API_BASE}/subscriptions/plans`);
console.log(plans.data.plans.pro); // Pro è®¡åˆ’è¯¦æƒ…
```

### æ¿€æ´» Pro è®¢é˜…ï¼ˆæµ‹è¯•æ¨¡å¼ï¼‰

```typescript
// æµ‹è¯•æ¨¡å¼ï¼šä¸€é”®æ¿€æ´»
const result = await axios.post(
  `${API_BASE}/subscriptions/test/activate`,
  {},
  {
    headers: { Authorization: `Bearer ${token}` }
  }
);

console.log('Pro activated!', result.data);
```

### æ£€æŸ¥åŠŸèƒ½è®¿é—®

```typescript
// æ£€æŸ¥æ˜¯å¦å¯ä»¥è®¿é—®é«˜çº§åŠŸèƒ½
const access = await axios.get(
  `${API_BASE}/subscriptions/check-access?feature=premium-prompts`,
  {
    headers: { Authorization: `Bearer ${token}` }
  }
);

if (access.data.hasAccess) {
  // æ˜¾ç¤ºé«˜çº§åŠŸèƒ½
}
```

---

## ğŸ—„ï¸ æ•°æ®åº“å˜æ›´

### æ–°å¢å­—æ®µ
- `users.stripe_customer_id` - Stripe å®¢æˆ· ID

### æ–°è¡¨
- `subscriptions` - è®¢é˜…ä¿¡æ¯è¡¨ï¼ˆå·²å­˜åœ¨ï¼‰

---

## ğŸ“‚ æ–°å¢æ–‡ä»¶

### åç«¯
- `backend/src/services/subscription.service.ts` - è®¢é˜…æœåŠ¡å±‚
- `backend/src/controllers/subscription.controller.ts` - æ§åˆ¶å™¨
- `backend/src/middleware/subscription.middleware.ts` - ä¸­é—´ä»¶
- `backend/src/routes/subscription.routes.ts` - è·¯ç”±
- `backend/src/types/express.d.ts` - TypeScript ç±»å‹æ‰©å±•

### å‰ç«¯
- `frontend/src/services/subscription.ts` - API æœåŠ¡
- `frontend/src/pages/PricingPage.tsx` - å®šä»·é¡µé¢
- `frontend/src/pages/SubscriptionManagementPage.tsx` - è®¢é˜…ç®¡ç†

### è„šæœ¬å’Œæ–‡æ¡£
- `/root/promptvalar/start-subscription-backend.sh` - å¯åŠ¨è„šæœ¬
- `/root/promptvalar/test-subscription-complete.sh` - å®Œæ•´æµ‹è¯•è„šæœ¬
- `/root/promptvalar/SUBSCRIPTION_GUIDE.md` - å®Œæ•´æŒ‡å—
- `/root/promptvalar/SUBSCRIPTION_SETUP.md` - å¿«é€Ÿå¼€å§‹
- `/root/promptvalar/è®¢é˜…ç³»ç»Ÿä½¿ç”¨è¯´æ˜.md` - ä¸­æ–‡è¯´æ˜

---

## ğŸ¯ ä¸‹ä¸€æ­¥

### ç«‹å³å¯åš
âœ… æµ‹è¯•å‰ç«¯å®šä»·é¡µé¢
âœ… æµ‹è¯•è®¢é˜…ç®¡ç†ç•Œé¢
âœ… è‡ªå®šä¹‰è®¢é˜…è®¡åˆ’
âœ… è°ƒæ•´ UI æ ·å¼

### å‡†å¤‡ä¸Šçº¿æ—¶
ğŸ“ æ³¨å†Œ Stripe è´¦å·
ğŸ“ é…ç½®ç”Ÿäº§å¯†é’¥
ğŸ“ è®¾ç½® Webhook
ğŸ“ æµ‹è¯•çœŸå®æ”¯ä»˜æµç¨‹

---

## ğŸŠ æ€»ç»“

**è®¢é˜…ç³»ç»Ÿå·²å®Œæ•´å®ç°å¹¶æµ‹è¯•é€šè¿‡ï¼**

**æ ¸å¿ƒæˆå°±**:
- âœ… å®Œæ•´çš„åç«¯ APIï¼ˆ1100+ è¡Œä»£ç ï¼‰
- âœ… ç²¾ç¾çš„å‰ç«¯ç•Œé¢ï¼ˆ1000+ è¡Œä»£ç ï¼‰
- âœ… æµ‹è¯•æ¨¡å¼å®Œç¾å·¥ä½œ
- âœ… æ‰€æœ‰ç«¯ç‚¹æµ‹è¯•é€šè¿‡
- âœ… è¯¦ç»†çš„æ–‡æ¡£å’Œæµ‹è¯•è„šæœ¬

**å¯ç”¨æ€§**:
- âœ… å¯ç«‹å³ç”¨äºå¼€å‘å’Œæµ‹è¯•
- âœ… æ— éœ€ Stripe è´¦å·å³å¯æµ‹è¯•å…¨éƒ¨åŠŸèƒ½
- âœ… åˆ‡æ¢åˆ°ç”Ÿäº§æ¨¡å¼åªéœ€é…ç½®å¯†é’¥
- âœ… å‰ç«¯å’Œåç«¯å®Œå…¨é›†æˆ

---

**æµ‹è¯•å®Œæˆæ—¶é—´**: 2025-10-26 14:17  
**æŠ¥å‘Šç”Ÿæˆ**: è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬

ğŸ‰ **ç¥è´ºï¼è®¢é˜…ç³»ç»Ÿå¼€å‘å®Œæˆï¼**

