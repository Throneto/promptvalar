# 📋 PromptValar 测试指南

## 概述

本文档提供了PromptValar平台的完整测试指南，包括本地测试和生产环境测试流程。

---

## 🧪 本地环境测试

### 前置准备

1. **确认服务状态**
   - ✅ 后端运行中：`http://localhost:5000`
   - ✅ 前端运行中：`http://localhost:3000`

2. **准备测试账号**
   - 需要至少一个已注册的账号
   - 如果没有，先注册一个测试账号

---

## 🚀 5分钟快速测试流程

### 测试 1：创建并保存提示词（核心功能）⭐

**步骤：**

1. **登录系统**
   - 访问：`http://localhost:3000`
   - 点击右上角 "Login"
   - 输入邮箱和密码
   - ✅ 确认：右上角显示用户头像和名字

2. **进入 Studio**
   - 点击导航栏的 "Studio"
   - 或直接访问：`http://localhost:3000/studio`
   - ✅ 确认：看到 "Prompt Studio" 页面

3. **生成提示词**
   - 在输入框输入：`a beautiful sunset over the ocean`
   - 选择模型：Sora（默认）
   - 选择风格：Cinematic（默认）
   - 点击 "Generate Prompt" 按钮
   - ⏳ 等待 AI 生成（5-10秒）
   - ✅ 确认：看到生成的提示词

4. **保存提示词** 🔥
   - 滚动到页面底部
   - 找到绿色的大按钮："Save Prompt"
   - 点击这个按钮
   - ✅ 确认：弹出保存对话框

5. **填写表单**
   - **Title**（必填）：输入 `Beautiful Ocean Sunset`
   - **Description**：输入 `A cinematic sunset scene`
   - **Category**：选择 `Video Generation`
   - **Tags**：
     - 输入 `sunset` 按回车
     - 输入 `ocean` 按回车
     - 或点击推荐标签：`cinematic`
   - ✅ 确认：所有字段填写完成

6. **提交保存**
   - 点击对话框底部的 "Save" 按钮
   - ⏳ 等待保存
   - ✅ **关键验证点：**
     - 右上角出现成功提示："Prompt saved successfully!"
     - 2秒后自动跳转到详情页
     - 详情页显示刚才保存的提示词

---

### 测试 2：编辑提示词 ✏️

**步骤：**

1. **进入"My Prompts"**
   - 点击右上角用户头像
   - 选择 "My Prompts"
   - 或直接访问：`http://localhost:3000/dashboard/prompts`
   - ✅ 确认：看到刚才创建的提示词

2. **点击编辑**
   - 找到刚才创建的提示词卡片
   - 悬停在卡片上
   - 点击 "Edit" 按钮
   - ✅ 确认：跳转到 Studio，URL 包含 `?edit=xxx`

3. **验证数据加载**
   - ✅ 页面标题变为 "Edit Prompt"
   - ✅ 提示词内容已经显示
   - ✅ 保存按钮文字变为 "Update Prompt"

4. **修改并更新**
   - 在结构化编辑器中做一些修改
   - 点击 "Update Prompt" 按钮
   - 在对话框中修改标题，添加 `- Updated`
   - 点击 "Update"
   - ✅ 确认：
     - 显示 "Prompt updated successfully!"
     - 跳转回详情页
     - 看到更新后的内容

---

### 测试 3：草稿自动保存 💾

**步骤：**

1. **开始新的提示词**
   - 访问：`http://localhost:3000/studio`（新页面）
   - 输入想法：`a futuristic city`
   - 生成提示词
   - ✅ 确认：提示词已生成

2. **测试草稿保存**
   - **不要点击保存！**
   - 直接刷新页面（F5）
   - ✅ **关键验证：**
     - 刷新后，之前的内容自动恢复了
     - 想法还在
     - 生成的提示词还在

3. **测试草稿清除**
   - 保存这个提示词
   - 成功保存后，关闭标签页
   - 重新打开：`http://localhost:3000/studio`
   - ✅ 确认：页面是空的（草稿已清除）

---

## 🌐 生产环境测试

### 测试准备

**测试账号信息**（如果已创建）：
```
域名: https://your-domain.com
邮箱: test@example.com
密码: [测试密码]
```

### 部署后验证步骤

#### 1. 检查服务状态

```bash
# 如果使用PM2
pm2 status

# 查看应用日志
pm2 logs --lines 50
```

#### 2. 验证网站访问

```bash
# 测试后端 API
curl -I https://api.your-domain.com/health

# 测试前端访问
curl -I https://your-domain.com
```

#### 3. 浏览器测试

**重要：清除浏览器缓存！**

1. 访问网站
2. 按 `Ctrl + Shift + Delete` 清除缓存
3. 或使用硬刷新 `Ctrl + Shift + R`
4. 登录账户
5. 测试核心功能：
   - Studio 生成功能
   - 保存功能
   - My Prompts 页面
   - My Favorites 页面

---

## ✅ 核心功能检查清单

完成测试后，检查以下项目：

### 基础功能
- [ ] 用户能成功注册
- [ ] 用户能成功登录
- [ ] 登录后正确显示用户信息
- [ ] 能正常登出

### Studio 功能
- [ ] 能进入 Studio 页面
- [ ] 能输入想法并选择模型
- [ ] 能成功生成提示词
- [ ] 能看到结构化编辑器
- [ ] 能复制提示词
- [ ] 能看到保存按钮
- [ ] 能打开保存对话框
- [ ] 能成功保存到数据库
- [ ] 保存后自动跳转到详情页

### Dashboard 功能
- [ ] 能访问 My Prompts 页面
- [ ] 能看到创建的提示词列表
- [ ] 搜索功能正常
- [ ] 排序功能正常
- [ ] 能编辑提示词
- [ ] 能删除提示词
- [ ] 分页功能正常

### 草稿功能
- [ ] 草稿自动保存
- [ ] 刷新页面后草稿能恢复
- [ ] 保存后草稿被清除

### 收藏功能
- [ ] 能收藏提示词
- [ ] 能在 My Favorites 查看收藏
- [ ] 能取消收藏

---

## 🐛 常见问题排查

### 问题 1：生成提示词失败

**可能原因：**
- OpenRouter API key 未配置或无效
- 网络连接问题
- API 额度已用完

**解决方法：**
```bash
# 检查后端环境变量
cat backend/.env | grep OPENROUTER

# 查看后端日志
pm2 logs --lines 100
```

### 问题 2：保存按钮不显示

**原因：** 没有生成提示词

**解决：** 先点击 "Generate Prompt"，等待生成完成

### 问题 3：401 未授权错误

**原因：** 未登录或 token 过期

**解决：** 
- 清除浏览器缓存
- 重新登录
- 检查 localStorage 中的 token

### 问题 4：草稿没有恢复

**检查：**
```javascript
// 在浏览器 Console 输入
localStorage.getItem('promptvalar_draft')
```

### 问题 5：页面仍然显示旧内容

**原因：** 浏览器或服务器缓存

**解决：**
```bash
# 清除 Nginx 缓存（如果使用）
sudo systemctl reload nginx

# 强制重新构建前端
cd frontend
rm -rf dist node_modules/.vite
npm run build
```

---

## 📊 测试报告模板

测试完成后，建议记录测试结果：

```markdown
# 测试报告

**测试日期：** YYYY-MM-DD
**测试环境：** 本地/生产
**测试人员：** [姓名]

## 测试结果

### ✅ 通过的测试
- [x] 创建并保存提示词
- [x] 编辑提示词
- [x] 草稿自动保存
- [x] 搜索功能

### ❌ 失败的测试
- [ ] 收藏功能 - 错误：500 Internal Server Error

## 问题详情

### 问题 1：[问题标题]
- **严重程度：** 高/中/低
- **描述：** [详细描述]
- **重现步骤：**
  1. 步骤1
  2. 步骤2
- **错误信息：** [错误日志]
- **截图：** [如果有]

## 建议

- [改进建议1]
- [改进建议2]
```

---

## 🎯 测试优先级

### P0 - 核心功能（必须通过）
- 用户登录/注册
- 提示词生成
- 提示词保存
- 基本查看功能

### P1 - 重要功能
- 提示词编辑
- 草稿保存
- 搜索和筛选
- 分页

### P2 - 次要功能
- 收藏功能
- 通知提示
- 动画效果

---

## 📞 需要帮助？

如果在测试过程中遇到问题：

1. 查看浏览器控制台（F12）
2. 检查网络请求（Network 标签）
3. 查看后端日志
4. 参考本文档的"常见问题排查"部分
5. 记录详细的错误信息和重现步骤

---

**祝测试顺利！** 🚀

*最后更新：2025-10-25*

