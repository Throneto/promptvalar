# PromptValar ç®¡ç†å‘˜æŒ‡å—

**æœ€åæ›´æ–°**: 2025-10-29  
**ç‰ˆæœ¬**: v1.0.0  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

---

## ğŸ“‹ ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [è®¿é—®ç®¡ç†åå°](#è®¿é—®ç®¡ç†åå°)
3. [åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·](#åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·)
4. [ç®¡ç†åå°åŠŸèƒ½](#ç®¡ç†åå°åŠŸèƒ½)
5. [APIç«¯ç‚¹](#apiç«¯ç‚¹)
6. [æƒé™æ§åˆ¶](#æƒé™æ§åˆ¶)
7. [ä½¿ç”¨æµç¨‹](#ä½¿ç”¨æµç¨‹)
8. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)
9. [å®‰å…¨å»ºè®®](#å®‰å…¨å»ºè®®)

---

## ğŸ¯ æ¦‚è¿°

PromptValaræä¾›äº†å®Œæ•´çš„ç®¡ç†å‘˜åå°ç³»ç»Ÿï¼Œç”¨äºç®¡ç†ç”¨æˆ·ã€æç¤ºè¯å’ŒæŸ¥çœ‹ç³»ç»Ÿç»Ÿè®¡æ•°æ®ã€‚

### ç®¡ç†å‘˜æƒé™è¦æ±‚

ç®¡ç†å‘˜åå°ä½¿ç”¨`AdminRoute`ç»„ä»¶ä¿æŠ¤ï¼Œåªæœ‰æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„ç”¨æˆ·æ‰èƒ½è®¿é—®ï¼š

1. âœ… å·²ç™»å½•ï¼ˆæœ‰æ•ˆçš„JWT tokenï¼‰
2. âœ… ç”¨æˆ·è§’è‰²ä¸º`admin`ï¼ˆrole = 'admin'ï¼‰

å¦‚æœä¸æ»¡è¶³æ¡ä»¶ï¼Œå°†è¢«é‡å®šå‘ï¼š
- æœªç™»å½• â†’ `/login`
- å·²ç™»å½•ä½†éç®¡ç†å‘˜ â†’ `/`ï¼ˆé¦–é¡µï¼‰

---

## ğŸŒ è®¿é—®ç®¡ç†åå°

### ç®¡ç†åå°åœ°å€

#### å¼€å‘ç¯å¢ƒ
- **åœ°å€**: http://localhost:3000/admin
- **API**: http://localhost:5000/api/v1/admin/*

#### ç”Ÿäº§ç¯å¢ƒ
- **åœ°å€**: https://promptvalar.com/admin
- **API**: https://api.promptvalar.com/api/v1/admin/*

---

## ğŸ‘¤ åˆ›å»ºç®¡ç†å‘˜è´¦æˆ·

### æ–¹æ³•1: ä½¿ç”¨è®¾ç½®è„šæœ¬ï¼ˆæ¨èï¼‰

1. **å…ˆæ³¨å†Œä¸€ä¸ªæ™®é€šè´¦æˆ·**
   - è®¿é—® https://promptvalar.com/register
   - æˆ– http://localhost:3000/register
   - å¡«å†™ç”¨æˆ·åã€é‚®ç®±å’Œå¯†ç å®Œæˆæ³¨å†Œ

2. **å°†è´¦æˆ·è®¾ç½®ä¸ºç®¡ç†å‘˜**
```bash
cd /root/promptvalar
./set-admin.sh your-email@example.com
```

ç¤ºä¾‹ï¼š
```bash
./set-admin.sh admin@promptvalar.com
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
- å°†ç”¨æˆ·è§’è‰²æ›´æ–°ä¸ºadmin
- æ˜¾ç¤ºæ›´æ–°åçš„ç”¨æˆ·ä¿¡æ¯

### æ–¹æ³•2: ç›´æ¥ä¿®æ”¹æ•°æ®åº“

```bash
# ä½¿ç”¨postgresç”¨æˆ·è¿æ¥æ•°æ®åº“
sudo -u postgres psql -d promptvalar

# å°†ç”¨æˆ·è®¾ç½®ä¸ºç®¡ç†å‘˜
UPDATE users SET role = 'admin' WHERE email = 'your-email@example.com';

# éªŒè¯æ›´æ–°
SELECT id, username, email, role FROM users WHERE email = 'your-email@example.com';

# é€€å‡º
\q
```

### æ–¹æ³•3: ä½¿ç”¨PGPASSWORDç¯å¢ƒå˜é‡

```bash
PGPASSWORD=your-password psql -U promptvalar -h localhost -d promptvalar -c "UPDATE users SET role = 'admin' WHERE email = 'your-email@example.com';"
```

---

## ğŸ¨ ç®¡ç†åå°åŠŸèƒ½

### 1. ä»ªè¡¨æ¿ï¼ˆ`/admin`ï¼‰

**åŠŸèƒ½**ï¼š
- ğŸ“Š ç³»ç»Ÿç»Ÿè®¡æ•°æ®ï¼ˆæ€»ç”¨æˆ·æ•°ã€æç¤ºè¯æ•°ã€æ”¶è—æ•°ç­‰ï¼‰
- ğŸ“ˆ ç”¨æˆ·å¢é•¿è¶‹åŠ¿å›¾è¡¨
- ğŸ† çƒ­é—¨æç¤ºè¯æ’è¡Œæ¦œ
- âš¡ å®æ—¶ç³»ç»ŸçŠ¶æ€

**å±•ç¤ºå†…å®¹**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š ç³»ç»Ÿç»Ÿè®¡                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‘¥ æ€»ç”¨æˆ·æ•°: 1,234                      â”‚
â”‚  ğŸ“ æ€»æç¤ºè¯æ•°: 5,678                    â”‚
â”‚  â­ æ€»æ”¶è—æ•°: 12,345                     â”‚
â”‚  ğŸ’ é«˜çº§ç”¨æˆ·: 123                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ˆ ç”¨æˆ·å¢é•¿è¶‹åŠ¿ï¼ˆæœ€è¿‘30å¤©ï¼‰              â”‚
â”‚  [æŠ˜çº¿å›¾]                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ† çƒ­é—¨æç¤ºè¯ TOP 10                    â”‚
â”‚  1. Prompt Title 1 - 1,234 views        â”‚
â”‚  2. Prompt Title 2 - 987 views          â”‚
â”‚  ...                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ç”¨æˆ·ç®¡ç†ï¼ˆ`/admin/users`ï¼‰

**åŠŸèƒ½**ï¼š
- ğŸ‘¥ æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·åˆ—è¡¨
- ğŸ” æœç´¢ç”¨æˆ·ï¼ˆç”¨æˆ·åã€é‚®ç®±ï¼‰
- âœï¸ ç¼–è¾‘ç”¨æˆ·ä¿¡æ¯
- ğŸ”‘ é‡ç½®ç”¨æˆ·å¯†ç 
- ğŸš« ç¦ç”¨/å¯ç”¨ç”¨æˆ·è´¦æˆ·
- ğŸ—‘ï¸ åˆ é™¤ç”¨æˆ·
- ğŸ“„ åˆ†é¡µæµè§ˆ

**å¯ç¼–è¾‘å­—æ®µ**ï¼š
- ç”¨æˆ·å
- é‚®ç®±
- è§’è‰²ï¼ˆuser/adminï¼‰
- è®¢é˜…ç­‰çº§ï¼ˆfree/proï¼‰
- è´¦æˆ·çŠ¶æ€ï¼ˆactive/disabledï¼‰

### 3. æç¤ºè¯ç®¡ç†ï¼ˆ`/admin/prompts`ï¼‰

**åŠŸèƒ½**ï¼š
- ğŸ“ æŸ¥çœ‹æ‰€æœ‰æç¤ºè¯
- ğŸ” æœç´¢å’Œç­›é€‰æç¤ºè¯
- âœï¸ ç¼–è¾‘æç¤ºè¯å†…å®¹
- ğŸ‘ï¸ è®¾ç½®æç¤ºè¯å¯è§æ€§ï¼ˆå‘å¸ƒ/å–æ¶ˆå‘å¸ƒï¼‰
- â­ è®¾ç½®é«˜çº§æç¤ºè¯æ ‡è®°
- ğŸ—‘ï¸ åˆ é™¤æç¤ºè¯
- ğŸ“„ åˆ†é¡µæµè§ˆ

**ç­›é€‰æ¡ä»¶**ï¼š
- æŒ‰æ¨¡å‹ç­›é€‰ï¼ˆSoraã€Midjourneyç­‰ï¼‰
- æŒ‰çŠ¶æ€ç­›é€‰ï¼ˆå·²å‘å¸ƒ/æœªå‘å¸ƒï¼‰
- æŒ‰é«˜çº§æ ‡è®°ç­›é€‰
- æŒ‰ä½œè€…ç­›é€‰

---

## ğŸ“¡ APIç«¯ç‚¹

ç®¡ç†å‘˜APIéœ€è¦åœ¨è¯·æ±‚å¤´ä¸­åŒ…å«æœ‰æ•ˆçš„JWT tokenï¼Œä¸”ç”¨æˆ·è§’è‰²å¿…é¡»ä¸ºadminã€‚

### ä»ªè¡¨æ¿ç»Ÿè®¡

```http
GET /api/v1/admin/dashboard/stats
Authorization: Bearer <token>
```

è¿”å›ï¼šæ€»ç”¨æˆ·æ•°ã€æç¤ºè¯æ•°ã€æ”¶è—æ•°ç­‰ç»Ÿè®¡æ•°æ®

### ç”¨æˆ·å¢é•¿æ•°æ®

```http
GET /api/v1/admin/dashboard/user-growth?days=30
Authorization: Bearer <token>
```

### çƒ­é—¨æç¤ºè¯

```http
GET /api/v1/admin/dashboard/top-prompts?limit=10
Authorization: Bearer <token>
```

### ç”¨æˆ·åˆ—è¡¨

```http
GET /api/v1/admin/users?page=1&limit=20&search=keyword
Authorization: Bearer <token>
```

### æ›´æ–°ç”¨æˆ·

```http
PUT /api/v1/admin/users/:userId
Authorization: Bearer <token>
Content-Type: application/json

{
  "role": "admin",
  "isActive": true,
  "subscriptionTier": "premium"
}
```

### é‡ç½®ç”¨æˆ·å¯†ç 

```http
POST /api/v1/admin/users/:userId/reset-password
Authorization: Bearer <token>
Content-Type: application/json

{
  "newPassword": "new-secure-password"
}
```

### åˆ é™¤ç”¨æˆ·

```http
DELETE /api/v1/admin/users/:userId
Authorization: Bearer <token>
```

### æç¤ºè¯åˆ—è¡¨

```http
GET /api/v1/admin/prompts?page=1&limit=20&search=keyword
Authorization: Bearer <token>
```

### æ›´æ–°æç¤ºè¯

```http
PUT /api/v1/admin/prompts/:promptId
Authorization: Bearer <token>
Content-Type: application/json

{
  "isPublished": true,
  "isPremium": false
}
```

### åˆ é™¤æç¤ºè¯

```http
DELETE /api/v1/admin/prompts/:promptId
Authorization: Bearer <token>
```

---

## ğŸ›¡ï¸ æƒé™æ§åˆ¶

### å‰ç«¯è·¯ç”±ä¿æŠ¤

æ–‡ä»¶ï¼š`frontend/src/components/auth/AdminRoute.tsx`

```typescript
export default function AdminRoute({ children }: AdminRouteProps) {
  const isAuth = isAuthenticated();
  const isAdminUser = isAdmin();

  // æœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ
  if (!isAuth) {
    return <Navigate to="/login" replace />;
  }

  // å·²ç™»å½•ä½†ä¸æ˜¯ç®¡ç†å‘˜ï¼Œé‡å®šå‘åˆ°é¦–é¡µ
  if (!isAdminUser) {
    return <Navigate to="/" replace />;
  }

  // æ˜¯ç®¡ç†å‘˜ï¼Œå…è®¸è®¿é—®
  return <>{children}</>;
}
```

### åç«¯ä¸­é—´ä»¶ä¿æŠ¤

æ–‡ä»¶ï¼š`backend/src/middleware/auth.middleware.ts`

æ‰€æœ‰ç®¡ç†å‘˜APIç«¯ç‚¹éƒ½å—åˆ°ä¸­é—´ä»¶ä¿æŠ¤ï¼Œä¼šéªŒè¯ï¼š
1. JWT tokenæœ‰æ•ˆæ€§
2. ç”¨æˆ·è§’è‰²æ˜¯å¦ä¸ºadmin

---

## ğŸ“ ä½¿ç”¨æµç¨‹

### å®Œæ•´è®¿é—®æµç¨‹

1. **æ³¨å†Œè´¦æˆ·**
   ```
   è®¿é—® /register â†’ å¡«å†™ä¿¡æ¯ â†’ æäº¤æ³¨å†Œ
   ```

2. **è®¾ç½®ç®¡ç†å‘˜æƒé™**
   ```bash
   cd /root/promptvalar
   ./set-admin.sh your-email@example.com
   ```

3. **ç™»å½•ç³»ç»Ÿ**
   ```
   è®¿é—® /login â†’ è¾“å…¥é‚®ç®±å’Œå¯†ç  â†’ ç™»å½•
   ```

4. **è®¿é—®ç®¡ç†åå°**
   ```
   è®¿é—® /admin â†’ æŸ¥çœ‹ä»ªè¡¨æ¿
   è®¿é—® /admin/users â†’ ç®¡ç†ç”¨æˆ·
   è®¿é—® /admin/prompts â†’ ç®¡ç†æç¤ºè¯
   ```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### 1. æ— æ³•è®¿é—®ç®¡ç†åå°ï¼ˆè¢«é‡å®šå‘åˆ°é¦–é¡µï¼‰

**åŸå› **: è´¦æˆ·æ²¡æœ‰ç®¡ç†å‘˜æƒé™

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥ç”¨æˆ·è§’è‰²
sudo -u postgres psql -d promptvalar -c "SELECT email, role FROM users WHERE email = 'your-email@example.com';"

# å¦‚æœroleä¸æ˜¯'admin'ï¼Œæ‰§è¡Œè®¾ç½®è„šæœ¬
./set-admin.sh your-email@example.com
```

### 2. ç™»å½•åä»ç„¶æ— æ³•è®¿é—®

**åŸå› **: localStorageä¸­çš„ç”¨æˆ·ä¿¡æ¯æœªæ›´æ–°

**è§£å†³æ–¹æ¡ˆ**:
1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’ŒlocalStorage
2. é€€å‡ºç™»å½•
3. é‡æ–°ç™»å½•

æˆ–åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œï¼š
```javascript
localStorage.clear();
window.location.reload();
```

### 3. APIè¿”å›403 Forbidden

**åŸå› **: JWT tokenä¸­çš„ç”¨æˆ·è§’è‰²ä¸æ˜¯admin

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤æ•°æ®åº“ä¸­ç”¨æˆ·è§’è‰²å·²æ›´æ–°ä¸ºadmin
2. é€€å‡ºç™»å½•å¹¶é‡æ–°ç™»å½•ä»¥è·å–æ–°çš„token
3. æ–°çš„tokenä¼šåŒ…å«æ›´æ–°åçš„ç”¨æˆ·è§’è‰²ä¿¡æ¯

### 4. æ•°æ®åº“è¿æ¥å¤±è´¥

å¦‚æœä½¿ç”¨è„šæœ¬æ—¶å‡ºç°è¿æ¥é”™è¯¯ï¼š

```bash
# æ–¹æ³•1: ä½¿ç”¨postgresç”¨æˆ·
sudo -u postgres psql -d promptvalar

# æ–¹æ³•2: æŒ‡å®šä¸»æœºï¼ˆä½¿ç”¨TCPè¿æ¥ï¼‰
PGPASSWORD=your-password psql -U promptvalar -h localhost -d promptvalar
```

---

## ğŸ”’ å®‰å…¨å»ºè®®

### 1. å¯†ç å®‰å…¨
- ä½¿ç”¨å¼ºå¯†ç 
- å®šæœŸæ›´æ¢å¯†ç 
- ä¸è¦åœ¨å…¬å…±åœºæ‰€ç™»å½•ç®¡ç†åå°

### 2. æƒé™ç®¡ç†
- ä»…ç»™äºˆå¿…è¦äººå‘˜ç®¡ç†å‘˜æƒé™
- å®šæœŸå®¡æŸ¥ç®¡ç†å‘˜è´¦æˆ·åˆ—è¡¨
- åŠæ—¶æ’¤é”€ç¦»èŒäººå‘˜çš„ç®¡ç†å‘˜æƒé™

### 3. æ“ä½œæ—¥å¿—
- æ‰€æœ‰ç®¡ç†å‘˜æ“ä½œéƒ½åº”è¯¥è¢«è®°å½•
- å®šæœŸæ£€æŸ¥æ“ä½œæ—¥å¿—

### 4. æ•°æ®åº“è®¿é—®
- é™åˆ¶æ•°æ®åº“è®¿é—®æƒé™
- ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç›´æ¥ä¿®æ”¹æ•°æ®åº“

### 5. å®¡è®¡å’Œç›‘æ§
- è®°å½•æ‰€æœ‰ç®¡ç†å‘˜æ“ä½œ
- è®¾ç½®å¼‚å¸¸æ“ä½œå‘Šè­¦
- å®šæœŸå®¡æŸ¥ç®¡ç†å‘˜æ´»åŠ¨æ—¥å¿—

---

## ğŸ¯ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# æŸ¥çœ‹æ‰€æœ‰ç®¡ç†å‘˜
sudo -u postgres psql -d promptvalar -c "SELECT username, email, role FROM users WHERE role = 'admin';"

# è®¾ç½®ç”¨æˆ·ä¸ºç®¡ç†å‘˜
./set-admin.sh user@example.com

# å–æ¶ˆç®¡ç†å‘˜æƒé™
sudo -u postgres psql -d promptvalar -c "UPDATE users SET role = 'user' WHERE email = 'user@example.com';"

# æŸ¥çœ‹ç”¨æˆ·è¯¦æƒ…
sudo -u postgres psql -d promptvalar -c "SELECT * FROM users WHERE email = 'user@example.com';"

# æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·
sudo -u postgres psql -d promptvalar -c "SELECT username, email, role, subscription_tier, is_active FROM users;"
```

---

## ğŸ“Š ç®¡ç†å‘˜æ“ä½œæ—¥å¿—

ç³»ç»Ÿè‡ªåŠ¨è®°å½•æ‰€æœ‰ç®¡ç†å‘˜æ“ä½œï¼ŒåŒ…æ‹¬ï¼š

- ç”¨æˆ·ä¿¡æ¯ä¿®æ”¹
- å¯†ç é‡ç½®
- ç”¨æˆ·åˆ é™¤
- æç¤ºè¯ç¼–è¾‘
- æç¤ºè¯åˆ é™¤
- æƒé™å˜æ›´

æŸ¥çœ‹æ—¥å¿—ï¼š

```bash
# é€šè¿‡APIæŸ¥çœ‹
GET /api/v1/admin/logs
Authorization: Bearer <token>

# é€šè¿‡æ•°æ®åº“æŸ¥çœ‹
sudo -u postgres psql -d promptvalar -c "SELECT * FROM admin_action_logs ORDER BY created_at DESC LIMIT 20;"
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [éƒ¨ç½²æŒ‡å—](./DEPLOYMENT.md) - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- [è®¢é˜…ç³»ç»ŸæŒ‡å—](./SUBSCRIPTION.md) - è®¢é˜…ç³»ç»Ÿé…ç½®
- [æµ‹è¯•æŒ‡å—](./TESTING_GUIDE.md) - æµ‹è¯•æµç¨‹å’Œè§„èŒƒ

---

## ğŸ‰ å¼€å§‹ä½¿ç”¨

ç°åœ¨æ‚¨å¯ä»¥ï¼š

1. âœ… ä½¿ç”¨ç®¡ç†å‘˜è´¦æˆ·ç™»å½•
2. âœ… è®¿é—® /admin æŸ¥çœ‹ç®¡ç†åå°
3. âœ… ç®¡ç†ç”¨æˆ·å’Œæç¤ºè¯
4. âœ… æŸ¥çœ‹ç³»ç»Ÿç»Ÿè®¡æ•°æ®

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼** ğŸš€

---

**ç®¡ç†å‘˜ç³»ç»ŸçŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª  
**æƒé™æ§åˆ¶**: âœ… å®Œæ•´å®ç°  
**æ“ä½œå®¡è®¡**: âœ… å®Œå…¨æ”¯æŒ

